<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conectar con MetaMask</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
    <h1>Conectar a MetaMask</h1>
    <button id="connectButton">Conectar Wallet</button>
    <div id="status"></div>

    <script>
        // Direcciones (REEMPLAZA CON LAS TUYAS)
        const CONTRACT_ADDRESS = "0xd9145CCE52D386f254917e481eB44e9943F39138";
        const CONTRACT_ABI = [
            // ABI de tu contrato (generado al compilar en Remix)
			[
				{
					"inputs": [
						{
							"internalType": "uint256",
							"name": "transferId",
							"type": "uint256"
						}
					],
					"name": "acceptTransfer",
					"outputs": [],
					"stateMutability": "nonpayable",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "address",
							"name": "userAddress",
							"type": "address"
						},
						{
							"internalType": "enum SupplyChainTracker.UserStatus",
							"name": "newStatus",
							"type": "uint8"
						}
					],
					"name": "changeStatusUser",
					"outputs": [],
					"stateMutability": "nonpayable",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "string",
							"name": "name",
							"type": "string"
						},
						{
							"internalType": "uint256",
							"name": "totalSupply",
							"type": "uint256"
						},
						{
							"internalType": "string",
							"name": "features",
							"type": "string"
						},
						{
							"internalType": "uint256",
							"name": "parentId",
							"type": "uint256"
						}
					],
					"name": "createToken",
					"outputs": [],
					"stateMutability": "nonpayable",
					"type": "function"
				},
				{
					"inputs": [],
					"stateMutability": "nonpayable",
					"type": "constructor"
				},
				{
					"inputs": [],
					"name": "ReentrancyGuardReentrantCall",
					"type": "error"
				},
				{
					"inputs": [
						{
							"internalType": "uint256",
							"name": "transferId",
							"type": "uint256"
						}
					],
					"name": "rejectTransfer",
					"outputs": [],
					"stateMutability": "nonpayable",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "bytes32",
							"name": "role",
							"type": "bytes32"
						}
					],
					"name": "requestUserRole",
					"outputs": [],
					"stateMutability": "nonpayable",
					"type": "function"
				},
				{
					"anonymous": false,
					"inputs": [
						{
							"indexed": true,
							"internalType": "uint256",
							"name": "tokenId",
							"type": "uint256"
						},
						{
							"indexed": true,
							"internalType": "address",
							"name": "creator",
							"type": "address"
						},
						{
							"indexed": false,
							"internalType": "string",
							"name": "name",
							"type": "string"
						},
						{
							"indexed": false,
							"internalType": "uint256",
							"name": "totalSupply",
							"type": "uint256"
						}
					],
					"name": "TokenCreated",
					"type": "event"
				},
				{
					"inputs": [
						{
							"internalType": "address",
							"name": "to",
							"type": "address"
						},
						{
							"internalType": "uint256",
							"name": "tokenId",
							"type": "uint256"
						},
						{
							"internalType": "uint256",
							"name": "amount",
							"type": "uint256"
						}
					],
					"name": "transfer",
					"outputs": [],
					"stateMutability": "nonpayable",
					"type": "function"
				},
				{
					"anonymous": false,
					"inputs": [
						{
							"indexed": true,
							"internalType": "uint256",
							"name": "transferId",
							"type": "uint256"
						}
					],
					"name": "TransferAccepted",
					"type": "event"
				},
				{
					"anonymous": false,
					"inputs": [
						{
							"indexed": true,
							"internalType": "uint256",
							"name": "transferId",
							"type": "uint256"
						}
					],
					"name": "TransferRejected",
					"type": "event"
				},
				{
					"anonymous": false,
					"inputs": [
						{
							"indexed": true,
							"internalType": "uint256",
							"name": "transferId",
							"type": "uint256"
						},
						{
							"indexed": true,
							"internalType": "address",
							"name": "from",
							"type": "address"
						},
						{
							"indexed": true,
							"internalType": "address",
							"name": "to",
							"type": "address"
						},
						{
							"indexed": false,
							"internalType": "uint256",
							"name": "tokenId",
							"type": "uint256"
						},
						{
							"indexed": false,
							"internalType": "uint256",
							"name": "amount",
							"type": "uint256"
						}
					],
					"name": "TransferRequested",
					"type": "event"
				},
				{
					"anonymous": false,
					"inputs": [
						{
							"indexed": true,
							"internalType": "address",
							"name": "user",
							"type": "address"
						},
						{
							"indexed": false,
							"internalType": "bytes32",
							"name": "role",
							"type": "bytes32"
						}
					],
					"name": "UserRoleRequested",
					"type": "event"
				},
				{
					"anonymous": false,
					"inputs": [
						{
							"indexed": true,
							"internalType": "address",
							"name": "user",
							"type": "address"
						},
						{
							"indexed": false,
							"internalType": "enum SupplyChainTracker.UserStatus",
							"name": "status",
							"type": "uint8"
						}
					],
					"name": "UserStatusChanged",
					"type": "event"
				},
				{
					"inputs": [
						{
							"internalType": "address",
							"name": "",
							"type": "address"
						}
					],
					"name": "addressToUserId",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "admin",
					"outputs": [
						{
							"internalType": "address",
							"name": "",
							"type": "address"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "uint256",
							"name": "tokenId",
							"type": "uint256"
						}
					],
					"name": "getToken",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "id",
							"type": "uint256"
						},
						{
							"internalType": "address",
							"name": "creator",
							"type": "address"
						},
						{
							"internalType": "string",
							"name": "name",
							"type": "string"
						},
						{
							"internalType": "uint256",
							"name": "totalSupply",
							"type": "uint256"
						},
						{
							"internalType": "string",
							"name": "features",
							"type": "string"
						},
						{
							"internalType": "uint256",
							"name": "parentId",
							"type": "uint256"
						},
						{
							"internalType": "uint256",
							"name": "dateCreated",
							"type": "uint256"
						},
						{
							"internalType": "uint256",
							"name": "balance",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "uint256",
							"name": "tokenId",
							"type": "uint256"
						},
						{
							"internalType": "address",
							"name": "user",
							"type": "address"
						}
					],
					"name": "getTokenBalance",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "uint256",
							"name": "transferId",
							"type": "uint256"
						}
					],
					"name": "getTransfer",
					"outputs": [
						{
							"components": [
								{
									"internalType": "uint256",
									"name": "id",
									"type": "uint256"
								},
								{
									"internalType": "address",
									"name": "from",
									"type": "address"
								},
								{
									"internalType": "address",
									"name": "to",
									"type": "address"
								},
								{
									"internalType": "uint256",
									"name": "tokenId",
									"type": "uint256"
								},
								{
									"internalType": "uint256",
									"name": "dateCreated",
									"type": "uint256"
								},
								{
									"internalType": "uint256",
									"name": "amount",
									"type": "uint256"
								},
								{
									"internalType": "enum SupplyChainTracker.TransferStatus",
									"name": "status",
									"type": "uint8"
								}
							],
							"internalType": "struct SupplyChainTracker.Transfer",
							"name": "",
							"type": "tuple"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "address",
							"name": "userAddress",
							"type": "address"
						}
					],
					"name": "getUserInfo",
					"outputs": [
						{
							"components": [
								{
									"internalType": "uint256",
									"name": "id",
									"type": "uint256"
								},
								{
									"internalType": "address",
									"name": "userAddress",
									"type": "address"
								},
								{
									"internalType": "bytes32",
									"name": "role",
									"type": "bytes32"
								},
								{
									"internalType": "enum SupplyChainTracker.UserStatus",
									"name": "status",
									"type": "uint8"
								}
							],
							"internalType": "struct SupplyChainTracker.User",
							"name": "",
							"type": "tuple"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "address",
							"name": "user",
							"type": "address"
						}
					],
					"name": "getUserTokens",
					"outputs": [
						{
							"internalType": "uint256[]",
							"name": "",
							"type": "uint256[]"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "address",
							"name": "user",
							"type": "address"
						}
					],
					"name": "getUserTransfers",
					"outputs": [
						{
							"internalType": "uint256[]",
							"name": "",
							"type": "uint256[]"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "nextTokenId",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "nextTransferId",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [],
					"name": "nextUserId",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"name": "tokens",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "id",
							"type": "uint256"
						},
						{
							"internalType": "address",
							"name": "creator",
							"type": "address"
						},
						{
							"internalType": "string",
							"name": "name",
							"type": "string"
						},
						{
							"internalType": "uint256",
							"name": "totalSupply",
							"type": "uint256"
						},
						{
							"internalType": "string",
							"name": "features",
							"type": "string"
						},
						{
							"internalType": "uint256",
							"name": "parentId",
							"type": "uint256"
						},
						{
							"internalType": "uint256",
							"name": "dateCreated",
							"type": "uint256"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"name": "transfers",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "id",
							"type": "uint256"
						},
						{
							"internalType": "address",
							"name": "from",
							"type": "address"
						},
						{
							"internalType": "address",
							"name": "to",
							"type": "address"
						},
						{
							"internalType": "uint256",
							"name": "tokenId",
							"type": "uint256"
						},
						{
							"internalType": "uint256",
							"name": "dateCreated",
							"type": "uint256"
						},
						{
							"internalType": "uint256",
							"name": "amount",
							"type": "uint256"
						},
						{
							"internalType": "enum SupplyChainTracker.TransferStatus",
							"name": "status",
							"type": "uint8"
						}
					],
					"stateMutability": "view",
					"type": "function"
				},
				{
					"inputs": [
						{
							"internalType": "uint256",
							"name": "",
							"type": "uint256"
						}
					],
					"name": "users",
					"outputs": [
						{
							"internalType": "uint256",
							"name": "id",
							"type": "uint256"
						},
						{
							"internalType": "address",
							"name": "userAddress",
							"type": "address"
						},
						{
							"internalType": "bytes32",
							"name": "role",
							"type": "bytes32"
						},
						{
							"internalType": "enum SupplyChainTracker.UserStatus",
							"name": "status",
							"type": "uint8"
						}
					],
					"stateMutability": "view",
					"type": "function"
				}
			]
            // Agrega aquí todas las funciones que quieras llamar
        ];

        let provider;
        let signer;
        let contract;

        document.getElementById("connectButton").addEventListener("click", async () => {
            if (typeof window.ethereum === "undefined") {
                alert("¡MetaMask no está instalado!");
                return;
            }

            try {
                // Solicitar acceso a la cuenta
                await window.ethereum.request({ method: "eth_requestAccounts" });
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                const address = await signer.getAddress();
                document.getElementById("status").innerHTML =
                    `Conectado con: ${address}<br>
                    <button id="callContract">Llamar al contrato</button>`;

                // Ejemplo: Llamar a una función del contrato
                document.getElementById("callContract").addEventListener("click", async () => {
                    try {
                        // Ejemplo: Llamar a getValue() (ajusta según tu contrato)
                        const value = await contract.getValue();
                        alert(`Valor del contrato: ${value.toString()}`);
                    } catch (error) {
                        console.error(error);
                        alert("Error al llamar al contrato");
                    }
                });

            } catch (error) {
                console.error(error);
                alert("Error al conectar con MetaMask");
            }
        });
    </script>
</body>
</html>





